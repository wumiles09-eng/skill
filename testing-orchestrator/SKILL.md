---
name: testing-orchestrator
description: 测试策略与执行编排（单测/集成/E2E/回归）。制定测试计划、覆盖率要求、失败分析。当需要制定测试策略、分析测试失败、评估测试覆盖时使用。
---

# Testing Orchestrator - 测试编排器

## 目标

制定和执行全面的测试策略，确保代码质量和功能正确性。

## 测试分类

### 1. 单元测试 (Unit Testing)
**范围**: 单个函数/类/组件
**特点**:
- 快速执行（毫秒级）
- 隔离依赖（mock/stub）
- 覆盖边界条件

**覆盖率要求**:
- 核心业务逻辑: ≥90%
- 工具函数: ≥80%
- UI组件: ≥70%

### 2. 集成测试 (Integration Testing)
**范围**: 多个模块协作
**特点**:
- 测试模块间接口
- 使用真实依赖（数据库/API）
- 验证数据流

**重点测试**:
- API端点
- 数据库交互
- 外部服务调用

### 3. E2E测试 (End-to-End Testing)
**范围**: 完整用户流程
**特点**:
- 模拟真实用户操作
- 跨多个系统/页面
- 执行较慢（秒级）

**关键流程**:
- 注册→登录→核心功能→登出
- 支付流程
- 数据导入导出

### 4. 回归测试 (Regression Testing)
**范围**: 已有功能
**目的**: 确保新修改没有破坏现有功能

**触发条件**:
- 修复bug后
- 重构代码后
- 添加新功能后

## 测试策略制定

### Step 1: 识别测试范围

```markdown
## 测试范围分析

### 新功能
- 功能A: {描述}
- 功能B: {描述}

### 影响范围
- 模块X: 可能被影响
- 接口Y: 需要验证兼容性

### 回归清单
- [ ] 功能1: {测试点}
- [ ] 功能2: {测试点}
```

### Step 2: 制定测试计划

```markdown
## 测试计划

### 单元测试
- [ ] 核心逻辑: {测试点}
- [ ] 边界条件: {测试点}
- [ ] 错误处理: {测试点}

### 集成测试
- [ ] API集成: {测试点}
- [ ] 数据库集成: {测试点}

### E2E测试
- [ ] 主流程: {场景}
- [ ] 异常流程: {场景}

### 性能测试
- [ ] 响应时间: {指标}
- [ ] 并发: {指标}
```

### Step 3: 定义通过标准

```markdown
## 通过标准

### 功能正确性
- [ ] 所有P0功能正常
- [ ] 验收标准全部通过

### 质量指标
- [ ] 单测覆盖率 ≥80%
- [ ] 无P0/P1 bug
- [ ] 性能指标达标

### 回归验证
- [ ] 核心流程无异常
- [ ] 数据完整性验证
```

## 失败分析流程

### 1. 失败分类

```markdown
## 失败分析

### 失败类型
- [ ] 代码bug: 逻辑错误/边界条件/类型错误
- [ ] 配置问题: 环境变量/依赖版本
- [ ] 测试问题: 测试本身有误/flaky test
- [ ] 依赖问题: 外部服务/数据变更
```

### 2. 根因定位

```
测试失败
    ↓
1. 查看失败信息
    ├─ 错误消息?
    ├─ 堆栈跟踪?
    └─ 失败步骤?
    ↓
2. 本地复现
    ├─ 能复现?
    │   ├─ Yes → 单步调试
    │   └─ No → 检查环境差异
    ↓
3. 定位根因
    ├─ 代码逻辑问题?
    ├─ 数据问题?
    └─ 环境问题?
    ↓
4. 最小修复
```

### 3. 修复策略

```markdown
## 修复方案

### 立即修复
- 代码bug: {修复方案}
- 测试问题: {修复方案}

### 需要讨论
- 需求理解不一致: {记录并确认}
- 技术方案变更: {评估影响}

### 补充测试
- 漏测场景: {添加测试用例}
- 边界条件: {添加测试用例}
```

## 测试优先级

| 优先级 | 描述 | 示例 |
|--------|------|------|
| P0 | 核心功能，必须测试 | 用户登录、支付、数据保存 |
| P1 | 重要功能，应该测试 | 搜索、筛选、导出 |
| P2 | 边缘功能，可选测试 | 帮助文档、设置项 |

## 测试工具推荐

### 前端
- **Jest/Vitest**: 单元测试
- **React Testing Library**: 组件测试
- **Playwright/Cypress**: E2E测试
- **MSW**: API mock

### 后端
- **Go test**: Go单元/集成测试
- **pytest**: Python测试
- **Postman**: API测试

### 视觉测试
- **visual-test**: Playwright MCP视觉测试

## 质量门禁

### 提交前
```bash
# 运行所有测试
npm test

# 检查覆盖率
npm run test:coverage

# 类型检查
npm run typecheck

# Lint检查
npm run lint
```

### 发布前
- [ ] 所有测试通过
- [ ] 覆盖率达标
- [ ] 性能测试通过
- [ ] 安全扫描无高危问题

## 与其他技能的集成

### 触发条件
- `coding-executor` - 开发完成后触发测试
- `systematic-debugging` - Bug修复后触发回归测试
- `deployment-and-ops` - 部署前触发完整测试

### 协作技能
- `quality-gate` - 质量门禁检查
- `visual-test` - UI视觉测试
- `audit-website` - 网站质量审计

## 最佳实践

### 1. 测试金字塔
```
    E2E (少量)
   /          \
  /   集成     \  (适量)
 /____________\
   单元测试     (大量)
```

### 2. AAA模式
```javascript
test('should add two numbers', () => {
  // Arrange - 准备
  const a = 1, b = 2;

  // Act - 执行
  const result = add(a, b);

  // Assert - 断言
  expect(result).toBe(3);
});
```

### 3. 描述性测试名
- ❌ `test('test1')`
- ✅ `test('should return error when email is invalid')`

### 4. 独立性
- 每个测试独立运行
- 不依赖执行顺序
- 不依赖外部状态

---

**维护**: 根据项目经验持续优化
**来源**: Cursor Hi Offer testing-orchestrator
**相关**: quality-gate, visual-test, systematic-debugging
